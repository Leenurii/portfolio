<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¶ ë¦¬ì–¼ ê°•ì•„ì§€ ì¼€ì–´ ê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            max-width: 900px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        h1 {
            color: #2d3436;
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: #636e72;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-item {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
        }

        .puppy-area {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            box-shadow: inset 0 5px 20px rgba(0, 0, 0, 0.1);
            border: 3px solid #e9ecef;
        }

        .puppy-container {
            position: relative;
            display: inline-block;
        }

        .puppy-image {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #fff;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            animation: breathe 3s ease-in-out infinite;
        }

        .puppy-image:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .sound-indicator {
            position: absolute;
            top: -20px;
            right: -20px;
            background: #ff6b6b;
            color: white;
            padding: 10px;
            border-radius: 50%;
            font-size: 1.5em;
            animation: soundPulse 1.5s infinite;
            cursor: pointer;
        }

        @keyframes soundPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .mood-indicator {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 1.1em;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }

        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-btn {
            background: linear-gradient(45deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 25px 15px;
            border-radius: 20px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 184, 148, 0.4);
        }

        .action-btn:active {
            transform: translateY(-2px);
        }

        .action-icon {
            font-size: 2em;
        }

        .feedback {
            font-size: 1.4em;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .feedback.show {
            opacity: 1;
        }

        .feedback.correct {
            background: linear-gradient(45deg, #00b894, #55efc4);
            color: white;
            box-shadow: 0 5px 20px rgba(0, 184, 148, 0.3);
        }

        .feedback.wrong {
            background: linear-gradient(45deg, #e17055, #fd79a8);
            color: white;
            box-shadow: 0 5px 20px rgba(225, 112, 85, 0.3);
        }

        .next-btn, .restart-btn {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .next-btn:hover, .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
        }

        .game-over {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 40px;
            border-radius: 25px;
            margin-top: 20px;
            display: none;
            box-shadow: 0 10px 30px rgba(255, 234, 167, 0.5);
        }

        .stars {
            font-size: 3em;
            margin: 20px 0;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .volume-control {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .difficulty-selector {
            margin-bottom: 20px;
        }

        .difficulty-btn {
            background: #ddd;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active {
            background: #6c5ce7;
            color: white;
        }

        @media (max-width: 768px) {
            .puppy-image {
                width: 220px;
                height: 220px;
            }
            
            .actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 2.2em;
            }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            animation: particleFloat 3s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.5);
            }
        }
    </style>
</head>
<body>
    <div class="volume-control" onclick="handleVolumeToggle()" id="volumeBtn">ğŸ”Š</div>
    
    <div class="game-container">
        <h1>ğŸ¶ ë¦¬ì–¼ ê°•ì•„ì§€ ì¼€ì–´</h1>
        <p class="subtitle">ê°•ì•„ì§€ì˜ í‘œì •ê³¼ ì†Œë¦¬ë§Œìœ¼ë¡œ ë¬´ì—‡ì´ í•„ìš”í•œì§€ ì•Œì•„ë§ì¶°ë³´ì„¸ìš”!</p>
        
        <div class="difficulty-selector">
            <button class="difficulty-btn active" onclick="setDifficulty('easy')">ì‰¬ì›€</button>
            <button class="difficulty-btn" onclick="setDifficulty('normal')">ë³´í†µ</button>
            <button class="difficulty-btn" onclick="setDifficulty('hard')">ì–´ë ¤ì›€</button>
        </div>
        
        <div class="game-info">
            <div class="info-item">ì ìˆ˜: <span id="score">0</span></div>
            <div class="info-item">ë ˆë²¨: <span id="level">1</span></div>
            <div class="info-item">ì—°ì† ì •ë‹µ: <span id="streak">0</span></div>
            <div class="info-item">ìƒëª…: <span id="lives">â¤ï¸â¤ï¸â¤ï¸</span></div>
        </div>

        <div class="puppy-area">
            <div class="puppy-container">
                <img class="puppy-image" id="puppyImage" src="https://images.unsplash.com/photo-1583337130417-3346a1be7dee?w=400&h=400&fit=crop&crop=face" alt="ê°•ì•„ì§€">
                <div class="sound-indicator" id="soundIndicator" onclick="handleSoundClick()">ğŸ”Š</div>
                <div class="mood-indicator" id="moodIndicator">ğŸ˜</div>
            </div>
        </div>

        <div class="actions">
            <button class="action-btn" onclick="makeChoice('food')">
                <div class="action-icon">ğŸ–</div>
                <div>ë°¥ ì£¼ê¸°</div>
            </button>
            <button class="action-btn" onclick="makeChoice('water')">
                <div class="action-icon">ğŸ’§</div>
                <div>ë¬¼ ì£¼ê¸°</div>
            </button>
            <button class="action-btn" onclick="makeChoice('clean')">
                <div class="action-icon">ğŸ§¹</div>
                <div>ë˜¥ ì¹˜ìš°ê¸°</div>
            </button>
            <button class="action-btn" onclick="makeChoice('play')">
                <div class="action-icon">ğŸ¾</div>
                <div>ë†€ì•„ì£¼ê¸°</div>
            </button>
            <button class="action-btn" onclick="makeChoice('sleep')">
                <div class="action-icon">ğŸ˜´</div>
                <div>ì¬ì›Œì£¼ê¸°</div>
            </button>
            <button class="action-btn" onclick="makeChoice('bath')">
                <div class="action-icon">ğŸ›</div>
                <div>ëª©ìš•ì‹œí‚¤ê¸°</div>
            </button>
        </div>

        <div class="feedback" id="feedback"></div>
        <button class="next-btn" id="nextBtn" onclick="nextRound()" style="display: none;">ë‹¤ìŒ ë¼ìš´ë“œ</button>

        <div class="game-over" id="gameOver">
            <h2>ê²Œì„ ì¢…ë£Œ!</h2>
            <div class="stars" id="finalStars"></div>
            <p id="finalScore"></p>
            <p id="finalMessage"></p>
            <button class="restart-btn" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
        let score = 0;
        let level = 1;
        let lives = 3;
        let streak = 0;
        let currentNeed = '';
        let gameEnded = false;
        let soundEnabled = true;
        let difficulty = 'easy';
        let currentRoundAnswered = false;

        // ê°•ì•„ì§€ ìƒí™©ë³„ ë°ì´í„°
        const puppyStates = {
            food: {
                images: [
                    'https://images.unsplash.com/photo-1561037404-61cd46aa615b?w=400&h=400&fit=crop&crop=face',
                    'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=400&h=400&fit=crop&crop=face'
                ],
                mood: 'ğŸ˜‹',
                sounds: ['bark1', 'whine1'],
                correctMsg: 'ì •ë‹µ! ë§›ìˆê²Œ ë¨¹ê³  ìˆì–´ìš”! ğŸ–',
                wrongMsg: 'ì•„ë‹ˆì—ìš”... ë‹¤ë¥¸ ê²ƒì´ í•„ìš”í•´ìš”'
            },
            water: {
                images: [
                    'https://images.unsplash.com/photo-1544568100-847a948585b9?w=400&h=400&fit=crop&crop=face',
                    'https://images.unsplash.com/photo-1601758228041-f3b2795255f1?w=400&h=400&fit=crop&crop=face'
                ],
                mood: 'ğŸ˜›',
                sounds: ['pant1', 'pant2'],
                correctMsg: 'ë§ì•„ìš”! ì‹œì›í•˜ê²Œ ë§ˆì‹œê³  ìˆì–´ìš”! ğŸ’§',
                wrongMsg: 'í‹€ë ¸ì–´ìš”... ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”'
            },
            clean: {
                images: [
                    'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=400&fit=crop&crop=face',
                    'https://images.unsplash.com/photo-1518717758536-85ae29035b6d?w=400&h=400&fit=crop&crop=face'
                ],
                mood: 'ğŸ˜·',
                sounds: ['whine2', 'uncomfortable'],
                correctMsg: 'êµ¿! ê¹¨ë—í•´ì ¸ì„œ ê¸°ë»í•´ìš”! âœ¨',
                wrongMsg: 'ì•„ì§ ë¶ˆí¸í•´í•´ìš”...'
            },
            play: {
                images: [
                    'https://images.unsplash.com/photo-1552053831-71594a27632d?w=400&h=400&fit=crop&crop=face',
                    'https://images.unsplash.com/photo-1605568427561-40dd23c2acea?w=400&h=400&fit=crop&crop=face'
                ],
                mood: 'ğŸ˜†',
                sounds: ['excited1', 'playful'],
                correctMsg: 'ì•¼í˜¸! ì‹ ë‚˜ê²Œ ë†€ê³  ìˆì–´ìš”! ğŸ¾',
                wrongMsg: 'ì•„ë‹ˆì—ìš”... ë­”ê°€ ë‹¤ë¥¸ ê²Œ í•„ìš”í•´ìš”'
            },
            sleep: {
                images: [
                    'https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?w=400&h=400&fit=crop&crop=face',
                    'https://images.unsplash.com/photo-1541364983171-a8ba01e95cfc?w=400&h=400&fit=crop&crop=face'
                ],
                mood: 'ğŸ˜´',
                sounds: ['tired', 'yawn'],
                correctMsg: 'ì™„ë²½! í¸ì•ˆíˆ ì ë“¤ì—ˆì–´ìš”! ğŸ’¤',
                wrongMsg: 'ì•„ì§ ì ë“¤ì§€ ëª»í–ˆì–´ìš”...'
            },
            bath: {
                images: [
                    'https://images.unsplash.com/photo-1530281700549-e82e7bf110d6?w=400&h=400&fit=crop&crop=face',
                    'https://images.unsplash.com/photo-1548199973-03cce0bbc87b?w=400&h=400&fit=crop&crop=face'
                ],
                mood: 'ğŸ¤¢',
                sounds: ['dirty', 'uncomfortable'],
                correctMsg: 'ì˜í–ˆì–´ìš”! ê¹¨ë—í•´ì¡Œì–´ìš”! ğŸ›',
                wrongMsg: 'ì•„ì§ ë”ëŸ¬ì›Œìš”...'
            }
        };

        // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
        let audioContext;
        
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì°¨ë‹¨í•œ ê²½ìš° ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í›„ ì¬ê°œ
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }
            return audioContext;
        }

        // ì†Œë¦¬ ìƒì„± í•¨ìˆ˜ë“¤
        function createBarkSound() {
            try {
                const ctx = initAudio();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, ctx.currentTime + 0.1);
                oscillator.frequency.exponentialRampToValueAtTime(150, ctx.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.3);
            } catch (e) {
                console.log('Bark sound failed:', e);
            }
        }

        function createWhineSound() {
            try {
                const ctx = initAudio();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(500, ctx.currentTime + 0.5);
                oscillator.frequency.linearRampToValueAtTime(250, ctx.currentTime + 1);
                
                gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 1);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 1);
            } catch (e) {
                console.log('Whine sound failed:', e);
            }
        }

        function createPantSound() {
            try {
                const ctx = initAudio();
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const oscillator = ctx.createOscillator();
                        const gainNode = ctx.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(ctx.destination);
                        
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(150, ctx.currentTime);
                        
                        gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                        
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.2);
                    }, i * 300);
                }
            } catch (e) {
                console.log('Pant sound failed:', e);
            }
        }

        const soundFunctions = {
            bark1: createBarkSound,
            bark2: createBarkSound,
            whine1: createWhineSound,
            whine2: createWhineSound,
            pant1: createPantSound,
            pant2: createPantSound,
            excited1: createBarkSound,
            playful: createBarkSound,
            tired: createWhineSound,
            yawn: createWhineSound,
            dirty: createWhineSound,
            uncomfortable: createWhineSound
        };

        // ì‚¬ìš´ë“œ í´ë¦­ í•¸ë“¤ëŸ¬
        function handleSoundClick() {
            if (typeof playPuppySound === 'function') {
                playPuppySound();
            }
        }

        function playPuppySound() {
            if (!soundEnabled || !currentNeed) return;
            
            // ì²« í´ë¦­ ì‹œ ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
            initAudio();
            
            const state = puppyStates[currentNeed];
            const soundKey = state.sounds[Math.floor(Math.random() * state.sounds.length)];
            const soundFunction = soundFunctions[soundKey];
            
            if (soundFunction) {
                console.log('Playing sound:', soundKey); // ë””ë²„ê¹…ìš©
                soundFunction();
                
                // ì‚¬ìš´ë“œ ì¸ë””ì¼€ì´í„° ì• ë‹ˆë©”ì´ì…˜
                const indicator = document.getElementById('soundIndicator');
                indicator.style.animation = 'none';
                setTimeout(() => {
                    indicator.style.animation = 'soundPulse 0.5s ease-out';
                }, 10);
            }
        }

        function setDifficulty(newDifficulty) {
            difficulty = newDifficulty;
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function startNewRound() {
            if (gameEnded) return;
            
            currentRoundAnswered = false;
            const needKeys = Object.keys(puppyStates);
            const randomNeed = needKeys[Math.floor(Math.random() * needKeys.length)];
            currentNeed = randomNeed;
            
            const state = puppyStates[randomNeed];
            const randomImage = state.images[Math.floor(Math.random() * state.images.length)];
            
            // ê°•ì•„ì§€ ì´ë¯¸ì§€ì™€ í‘œì • ì—…ë°ì´íŠ¸
            document.getElementById('puppyImage').src = randomImage;
            
            // ë‚œì´ë„ì— ë”°ë¥¸ íŒíŠ¸ í‘œì‹œ
            if (difficulty === 'easy') {
                document.getElementById('moodIndicator').textContent = state.mood;
                document.getElementById('moodIndicator').style.display = 'block';
            } else if (difficulty === 'normal') {
                // 50% í™•ë¥ ë¡œ í‘œì • íŒíŠ¸
                if (Math.random() < 0.5) {
                    document.getElementById('moodIndicator').textContent = state.mood;
                    document.getElementById('moodIndicator').style.display = 'block';
                } else {
                    document.getElementById('moodIndicator').style.display = 'none';
                }
            } else {
                // ì–´ë ¤ì›€ ëª¨ë“œì—ì„œëŠ” íŒíŠ¸ ì—†ìŒ
                document.getElementById('moodIndicator').style.display = 'none';
            }
            
            // í”¼ë“œë°± ì´ˆê¸°í™”
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('show', 'correct', 'wrong');
            document.getElementById('nextBtn').style.display = 'none';
            
            // ìë™ìœ¼ë¡œ ì†Œë¦¬ ì¬ìƒ (ì–´ë ¤ì›€ ëª¨ë“œì—ì„œëŠ” ì†Œë¦¬ë„ ì—†ìŒ)
            if (difficulty !== 'hard') {
                setTimeout(() => {
                    if (typeof playPuppySound === 'function') {
                        playPuppySound();
                    }
                }, 1000);
            }
        }

        function makeChoice(choice) {
            if (gameEnded || currentRoundAnswered) return;
            
            currentRoundAnswered = true;
            const state = puppyStates[currentNeed];
            const feedbackEl = document.getElementById('feedback');
            
            if (choice === currentNeed) {
                // ì •ë‹µ
                const points = level * (10 + streak * 2);
                score += points;
                streak++;
                
                feedbackEl.textContent = state.correctMsg;
                feedbackEl.className = 'feedback correct show';
                
                createSuccessParticles();
                playSuccessSound();
                
                setTimeout(() => {
                    if (score >= level * 60) {
                        level++;
                        showLevelUp();
                    }
                    nextRound();
                }, 2000);
                
            } else {
                // ì˜¤ë‹µ
                lives--;
                streak = 0;
                
                feedbackEl.textContent = state.wrongMsg;
                feedbackEl.className = 'feedback wrong show';
                
                playErrorSound();
                updateDisplay();
                
                if (lives <= 0) {
                    endGame();
                } else {
                    document.getElementById('nextBtn').style.display = 'inline-block';
                }
            }
        }

        function createSuccessParticles() {
            const puppyArea = document.querySelector('.puppy-area');
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.textContent = ['â­', 'âœ¨', 'ğŸ‰', 'ğŸ’–'][Math.floor(Math.random() * 4)];
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.fontSize = (Math.random() * 20 + 20) + 'px';
                    puppyArea.appendChild(particle);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 3000);
                }, i * 100);
            }
        }

        function playSuccessSound() {
            if (!soundEnabled) return;
            
            try {
                const ctx = initAudio();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523, ctx.currentTime);
                oscillator.frequency.setValueAtTime(659, ctx.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(784, ctx.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.3);
            } catch (e) {
                console.log('Success sound failed:', e);
            }
        }

        function playErrorSound() {
            if (!soundEnabled) return;
            
            try {
                const ctx = initAudio();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.5);
                
                gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.5);
            } catch (e) {
                console.log('Error sound failed:', e);
            }
        }

        function showLevelUp() {
            const levelUpMsg = document.createElement('div');
            levelUpMsg.textContent = `ğŸ‰ ë ˆë²¨ ì—…! Level ${level}! ğŸ‰`;
            levelUpMsg.style.cssText = `
                position: fixed; top: 50%; left: 50%; 
                transform: translate(-50%, -50%); 
                font-size: 2.5em; color: #6c5ce7; 
                font-weight: bold; z-index: 1000; 
                background: white; padding: 20px 40px; 
                border-radius: 20px; 
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                animation: bounce 0.5s ease-out;
            `;
            document.body.appendChild(levelUpMsg);
            
            setTimeout(() => {
                levelUpMsg.remove();
            }, 3000);
        }

        // ë³¼ë¥¨ í† ê¸€ í•¸ë“¤ëŸ¬
        function handleVolumeToggle() {
            if (typeof toggleSound === 'function') {
                toggleSound();
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('volumeBtn').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        }

        function nextRound() {
            updateDisplay();
            startNewRound();
        }

        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('streak').textContent = streak;
            
            const heartsDisplay = 'â¤ï¸'.repeat(lives) + 'ğŸ’”'.repeat(3 - lives);
            document.getElementById('lives').textContent = heartsDisplay;
        }

        function endGame() {
            gameEnded = true;
            document.getElementById('gameOver').style.display = 'block';
            
            let stars = '';
            let message = '';
            
            if (score >= 200) {
                stars = 'â­â­â­';
                message = 'ì™€ìš°! ì§„ì§œ ê°•ì•„ì§€ ì „ë¬¸ê°€ë„¤ìš”! ğŸ†';
            } else if (score >= 100) {
                stars = 'â­â­
